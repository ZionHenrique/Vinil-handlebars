<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Compra - Vinil Store</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">Vinil Store</a>
            <nav class="nav">
                <a href="/">Home</a>
                <a href="/vinis">Vinis</a>
                <a href="/perfis">Clientes</a>
                <a href="/compras">Compras</a>
                <a href="/generos">Gêneros</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="form-container">
            <h1 class="card-title">Editar Compra</h1>
            <form action="/compras/{{compra.id}}/update" method="POST">
                <div class="form-group">
                    <label for="clienteId">Cliente:</label>
                    <select id="clienteId" name="clienteId" required>
                        {{#each perfis}}
                        <option value="{{id}}" {{#if (eq ../compra.clienteId id)}}selected{{/if}}>{{nome}} - {{email}}</option>
                        {{/each}}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="vinilId">Vinil:</label>
                    <select id="vinilId" name="vinilId" required>
                        {{#each vinis}}
                        <option value="{{id}}" data-preco="{{preco}}" data-estoque="{{quant}}" {{#if (eq ../compra.vinilId id)}}selected{{/if}}>{{nome}} - {{artista}} (R$ {{preco}}) - Estoque: {{quant}}</option>
                        {{/each}}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="quantidade">Quantidade:</label>
                    <input type="number" id="quantidade" name="quantidade" min="1" value="{{compra.quantidade}}" required>
                    <small style="display: block; margin-top: 5px; color: #666;" id="estoque-info">Selecione um vinil para ver o estoque disponível</small>
                </div>
                
                <div class="form-group">
                    <label for="data">Data da Compra:</label>
                    <input type="date" id="data" name="data" value="{{compra.data}}" required>
                </div>
                
                <div class="form-group">
                    <label>Total:</label>
                    <div style="font-size: 24px; font-weight: bold; color: var(--accent-color); padding: 12px; background: #f8f9fa; border-radius: 8px;" id="total-display">R$ {{compra.total}}</div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    <a href="/compras/{{compra.id}}" class="btn btn-secondary">Cancelar</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        const vinilSelect = document.getElementById('vinilId');
        const quantidadeInput = document.getElementById('quantidade');
        const estoqueInfo = document.getElementById('estoque-info');
        const totalDisplay = document.getElementById('total-display');

        function atualizarTotal() {
            const selectedOption = vinilSelect.options[vinilSelect.selectedIndex];
            if (selectedOption.value) {
                const preco = parseFloat(selectedOption.getAttribute('data-preco'));
                const estoque = parseInt(selectedOption.getAttribute('data-estoque'));
                const quantidade = parseInt(quantidadeInput.value) || 1;
                
                estoqueInfo.textContent = `Estoque disponível: ${estoque} unidades`;
                
                if (quantidade > estoque) {
                    estoqueInfo.style.color = '#dc3545';
                    estoqueInfo.textContent = `⚠️ Quantidade maior que o estoque disponível (${estoque} unidades)`;
                } else {
                    estoqueInfo.style.color = '#666';
                }
                
                const total = preco * quantidade;
                totalDisplay.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            } else {
                estoqueInfo.textContent = 'Selecione um vinil para ver o estoque disponível';
                totalDisplay.textContent = 'R$ 0,00';
            }
        }

        vinilSelect.addEventListener('change', atualizarTotal);
        quantidadeInput.addEventListener('input', atualizarTotal);
        atualizarTotal(); // Atualizar ao carregar
    </script>
</body>
</html>

